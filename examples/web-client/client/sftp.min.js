// http://github.com/lukaaash/sftp-ws/
var SFTP;!function(t){function e(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n}function n(t,e,n){function r(r){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var s=arguments[0];try{if("function"==typeof n)n.apply(t,arguments),s=null;else if(e)if(s)a.listenerCount(e,"error")&&(e.emit("error",s),s=null),e.emit("finish",s);else switch(arguments.length){case 0:case 1:e.emit("success"),e.emit("finish",s);break;case 2:e.emit("success",arguments[1]),e.emit("finish",s,arguments[1]);break;case 3:e.emit("success",arguments[1],arguments[2]),e.emit("finish",s,arguments[1],arguments[2]);break;default:arguments[0]="success",e.emit.apply(e,arguments),a.listenerCount(e,"finish")>0&&(arguments[0]="finish",Array.prototype.splice.call(arguments,1,0,s),e.emit.apply(e,arguments))}}catch(r){s&&t.emit("error",s),s=r}s&&t.emit("error",s)}return r}function r(t,e,n,r,i){r=r||e.length;var o,s,a;i?(o=0|i._code,s=0|i._length,a=0|i._position):(o=0,s=0,a=0);for(var h=!1,u=n;;){if(s>0){if(n>=r)break;if(e[n++]=o>>12|128,s>1){o=(4095&o)<<6,s--;continue}s=0,o=0}if(a>=t.length){if(a=0,0==o){h=!0;break}t=String.fromCharCode(65533),o=0}if(n>=r)break;var c=t.charCodeAt(a++);if(0==o){if(o=c,c>=55296&&56320>c){o=65536+((1023&o)<<10);continue}o=c>=56320&&57344>c?65533:c}else c>=56320&&57344>c?o+=1023&c:o=65533;127>=o?(e[n++]=o,o=0):2047>=o?(s=1,e[n++]=o>>6|192,o=(63&o)<<12):65535>=o?(s=2,e[n++]=o>>12|224,o=(4095&o)<<6):1114111>=o?(s=3,e[n++]=o>>18|240,o=2097151&o):(o=65533,s=2,e[n++]=o>>12|224,o=(4095&o)<<6)}if(i)i._code=o,i._length=s,i._position=a,i._done=h;else if(!h)return-1;return n-u}function i(t,e,n,r){n=n||t.length;var i,o,s;for(r?(i=r._text||"",o=0|r._code,s=0|r._length):(i="",o=0,s=0);n>e;){var a=t[e++];if(s>0){if(128!=(192&a))o=65533,s=0;else if(o=o<<6|63&a,s--,s>0)continue}else if(128>=a)o=a,s=0;else switch(224&a){case 224:16&a?(o=7&a,s=3):(o=15&a,s=2);continue;case 192:o=31&a,s=1;continue;default:o=65533,s=0}o>=65536&&(o-=65536,o>1048575?o=65533:(i+=String.fromCharCode(55296+(o>>10&1023)),o=56320+(1023&o))),i+=String.fromCharCode(o)}return r?(r._code=o,r._length=s,r._text=i,null):(s>0&&(i+=String.fromCharCode(65533)),i)}function o(t,e,n,r,i){function o(e,n){(0==e.length||m&&2==e.length&&":"==e[1])&&(e+="/"),w=new p(e,t).normalize(),n="/"+n;var r=null;if(!c){var i=n.indexOf("/**");i>=0&&(i==n.length-3?(r="*",n=n.substr(0,i)):"/"==n[i+3]&&(r=n.substr(i+4),n=n.substr(0,i)))}for(var o=n.split("/"),h=1;h<o.length;h++){var n=o[h],u=a(n,!1);b.push(u)}null!=r&&(b.push(null),g=a(r,!0)),k.push({path:new p("",null),pattern:0,depth:0}),s()}function s(){function e(e){var r=d.isDirectory(e.stats),i=d.isFile(e.stats),o="."==e.filename||".."==e.filename;if((!o||l)&&(r||i)){var s=a.join(e.filename);if(x&&r&&!o&&k.push({path:s,pattern:m,depth:v}),E&&!(r&&!u||i&&!h)){if(y){if(!y.test(e.filename))return}else if(!g.test(s.path))return;var c=new p(s.path,t).normalize();e.path=w.join(c).path,e.relativePath=c.path,_.push(e),n.emit("item",e)}}}var o=k.shift();if(!o)return r.nosort||_.sort(function(t,e){return t.relativePath<e.relativePath?-1:t.relativePath>e.relativePath?1:0}),i(null,_);var a,c,y,v,m,E,x;try{if(a=o.path,c=o.pattern,v=o.depth,y=b[c]){m=c+1;var S=m==b.length;E=S&&null==g,x=!S}else m=c,E=!0,x=0==f||f>0&&f>v,v++;var P=w.join(a).normalize().path;t.opendir(P,function(r,o){function a(r,c){try{if(u--,h=h||r,h||!c){if(u>0)return;return void t.close(o,function(t){return h=h||t,t?i(h,null):(n.emit("traversed",P),void s())})}for(c.forEach(e);2>u;)t.readdir(o,a),u++}catch(r){return h=h||r,i(h,null)}}if(r)return i(r,null);n.emit("traversing",P);var h=null,u=1;t.readdir(o,a)})}catch(I){return i(I,null)}}function a(t,e){var n="^";e&&(n+=".*");for(var r=0;r<t.length;r++){var i=t[r];switch(i){case"/":var o=t.substr(r,4);"/**/"==o||"/**"==o?(n+=".*",r+=3):n+="/";break;case"*":n+=e?"[^/]*":".*";break;case"?":n+=".";break;default:n+=i>="a"&&"z">=i||i>="A"&&"Z">=i||i>="0"&&"9">=i?i:"\\"+i}}n+="$";var s=m?"i":"";return new RegExp(n,s)}if(0==e.length)throw new Error("Empty path");n||(n={emit:function(){return!1}}),r=r||{};var h=!r.onlydir,u=!r.nodir,c=r.noglobstar||!1,f=0|r.depth,l=r.dotdirs||!1,y=r.listonly||!1,v=!r.noexpand;if(!h&&!u)throw new Error("Not matching anything with the specified options");var m=1==t.isWindows;e=new p(e,null).normalize().path,"/"==e[e.length-1]&&(v?e+="*":(e=e.substr(0,e.length-1),y=!0));var w,g,_=[],k=[],b=[],E=e.indexOf("*"),x=e.indexOf("?"),S=0>E?x:0>x?E:x;if(S>=0){if(r.nowildcard||r.itemonly)throw new Error("Wildcards not allowed");if(r.listonly){var P=e.indexOf("/",S);if(P>S)throw new Error("Wildcards only allowed in the last path segment")}S=e.lastIndexOf("/",S);var I=e.substr(S+1);e=S>=0?e.substr(0,S):".",o(e,I)}else t.stat(e,function(t,s){if(t)return i(t,null);try{if(!r.itemonly)if(d.isDirectory(s)){if(v)return o(e,"*")}else{if(y)return i(new Error("The specified path is not a directory"),null);if(!d.isFile(s))return i(null,_)}S=e.lastIndexOf("/");var a;0>S?(a=e,e="./"+a):a=e.substr(S+1);var h={filename:a,stats:s,path:e,relativePath:a};return _.push(h),n.emit("item",h),i(null,_)}catch(t){return i(t,null)}})}function s(t,e,n,r){function i(t){if(c(t))return f(t);if(u(t))return p(t);if(a(t))return s(t);throw new Error("Unsupported source")}function s(t){h.nextTick(function(){var e=new v(t,0);r(null,[e])})}function a(t){return"object"==typeof t&&"number"==typeof t.size&&"string"==typeof t.name&&"function"==typeof t.slice}function u(t){return"string"==typeof t}function c(t){return Array.isArray(t)?!0:"object"!=typeof t||"number"!=typeof t.length?!1:0==t.length?!0:u(t)||a(t[0])}function f(t){function e(){try{var t=s.shift();if(!t)return r(null,o);if(c(t))throw new Error("Unsupported array of arrays data source");u(t)?l(t,n):i(t,n)}catch(e){h.nextTick(function(){return r(e)})}}function n(t,n){return t?r(t,null):(Array.prototype.push.apply(o,n),void e())}var o=[],s=[];Array.prototype.push.apply(s,t),e()}function l(e,n){if(!t)throw new Error("Source file system not available");t.stat(e,function(r,i){if(r)return n(r,null);var o=new y(t,e,null,i,0);n(null,[o])})}function p(e){if(!t)throw new Error("Source file system not available");o(t,e,n,{noexpand:!0},function(e,n){if(e)return r(e,null);var i=[];n.forEach(function(e){var n=new y(t,e.path,e.relativePath,e.stats,0);i.push(n)}),r(null,i)})}try{i(e,r)}catch(d){h.nextTick(function(){return r(d)})}}var a=function(){function t(){this._events={}}return t.listenerCount=function(t,e){if(!t||"undefined"==typeof t._events)return 0;var n=t._events[e];return n?n.length:0},t.prototype.addListener=function(t,e){var n=this._events[t]||[];return n.push(e),this._events[t]=n,this},t.prototype.on=function(t,e){return this.addListener(t,e)},t.prototype.once=function(t,e){var n=this,r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];n.removeListener(t,r),e.apply(n,i)};return this.addListener(t,r)},t.prototype.removeListener=function(t,e){var n=this._events[t];if(Array.isArray(n)){var r=n.indexOf(e);return r>=0&&n.splice(r,1),this}},t.prototype.removeAllListeners=function(t){return"string"==typeof t?delete this._events[t]:"undefined"==typeof t&&(this._events={}),this},t.prototype.listeners=function(t){return this._events[t]},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this._events[t],i=!1;if(Array.isArray(r))for(var o=0;o<r.length;o++)r[o].apply(null,e),i=!0;if(!i&&"error"==t){var s=e[0];throw s}return i},t}(),h=function(){function t(){}return t.nextTick=function(t){window.setTimeout(t,0)},t.platform="browser",t}(),u=function(t){function n(){t.call(this)}return e(n,t),n.prototype.on=function(e,n){return t.prototype.on.call(this,e,n)},n}(a),c=function(){function t(t){var e=(t+"").toLowerCase().replace("-","");if("utf8"!=e)throw new Error("Encoding not supported: "+t)}return t.prototype.getEncoder=function(t){return new f(t)},t.prototype.getDecoder=function(){return new l},t.prototype.encode=function(t,e,n,i){return r(t,e,n,i)},t.prototype.decode=function(t,e,n){return i(t,e,n)},t.UTF8=new t("utf8"),t}(),f=function(){function t(t){"string"!=typeof t&&(t=""+t),this._value=t}return t.prototype.finished=function(){return this._done},t.prototype.read=function(t,e,n){return r(this._value,t,e,n,this)},t}(),l=function(){function t(){}return t.prototype.text=function(){return this._text},t.prototype.write=function(t,e,n){var r=(i(t,e,n,this),this._text);this._removeBom&&r.length>0&&(65279==r.charCodeAt(0)&&(this._text=r.substr(1)),this._removeBom=!1)},t}(),p=function(){function t(t,e){"string"!=typeof t&&(t=""+t),this.path=t,this.fs=e||null}return t.prototype._windows=function(){return this.fs&&this.fs.isWindows&&!0},t.prototype.isTop=function(){var t=this.path;if(0==t.length||"/"==t)return!0;if(this._windows()){if("\\"==t)return!0;if(":"!=t[1])return!1;if(2==t.length)return!0;if(3==t.length&&("/"==t[2]||"\\"==t[2]))return!0}return!1},t.prototype.getName=function(){var t=this.path,e=this._windows(),n=t.lastIndexOf("/");return 0>n&&e&&(n=t.lastIndexOf("\\")),0>n?t:t.substr(n+1)},t.prototype.getParent=function(){var e=this.path,n=this._windows(),r=e.lastIndexOf("/");return 0>r&&n&&(r=e.lastIndexOf("\\")),e=0>r?"":0==r?"/":e.substr(0,r),new t(e,this.fs)},t.prototype.startsWith=function(t){if(0==t.length)return!1;var e=this.path;if(e.length<t.length)return!1;if(1==t.length)return e[0]===t;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},t.prototype.endsWithSlash=function(){var t=this.path[this.path.length-1];return"/"==t?!0:"\\"==t&&this._windows()?!0:!1},t.prototype.removeTrailingSlash=function(){var e=this.path,n=this._windows(),r=e.length;if(r>1){var i=e[r-1];("/"==i||"\\"==i&&n)&&(e=e.substr(0,r-1))}return new t(e,this.fs)},t.prototype.normalize=function(){var e=this.path;return e=this._windows()?e.replace(/\//g,"\\"):e.replace(/\\/g,"/"),new t(e,this.fs)},t.prototype.toString=function(){return this.path},t.prototype.join=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];var r=""+this.path,i=this._windows();return e.forEach(function(t){if("undefined"!=typeof t&&(t=""+t,0!=t.length)){if(0==r.length||"/"===t[0]||"~"===t||"~"===t[0]&&"/"===t[1])return void(r=t);if(i&&("\\"===t[0]||"~"===t[0]&&"\\"===t[1]||":"===t[1]))return void(r=t);var e=r[r.length-1];"/"===e||i&&"\\"===e?r+=t:r=r+"/"+t}}),0==r.length?r=".":i&&(r=r.replace(/\//g,"\\")),new t(r,this.fs)},t.create=function(e,n,r){return e=t.check(e,r),new t(e,n).normalize()},t.check=function(t,e){if("undefined"==typeof e&&(e="path"),"string"!=typeof t){if(null===t||"undefined"==typeof t)throw new Error("Missing "+e);if("function"==typeof t)throw new Error("Invalid "+e);t=""+t}if(0==t.length)throw new Error("Empty "+e);return t},t}(),d=function(){function t(){}return t.isDirectory=function(t){return t?16384==(61440&t.mode):!1},t.isFile=function(t){return t?32768==(61440&t.mode):!1},t.toString=function(t,e){var n,r=e.mode;switch(61440&r){case 8192:n="c";break;case 16384:n="d";break;case 24576:n="b";break;case 32768:n="-";break;case 40960:n="l";break;case 49152:n="s";break;case 4096:n="p";break;default:n="-"}r&=511;for(var i=0;3>i;i++){var o=r>>3*(2-i)&7;n+=4&o?"r":"-",n+=2&o?"w":"-",n+=1&o?"x":"-"}var s=e.size.toString();s=s.length<9?"         ".slice(s.length-9)+s:" "+s;var a=e.mtime,h=((new Date).getTime()-a.getTime())/86400,u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a.getUTCMonth()],c=a.getUTCDate();u+=(9>=c?"  ":" ")+c,u+=-30>h||h>180?"  "+a.getUTCFullYear():" "+("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2);var f="undefined"==typeof e.nlink?1:e.nlink;return n+" "+f+" user group "+s+" "+u+" "+t},t.mkdir=function(e,n,r){e.stat(n,function(i,o){return i?"ENOENT"!=i.code?r(i):void e.mkdir(n,null,r):r(t.isDirectory(o)?null:new Error("Path is not a directory"))})},t.copy=function(t,e,n,r){function i(){var r=t.name;"undefined"==typeof r&&(r=""+e.name);var i=t.relativePath;"undefined"==typeof i&&(i=r),p={filename:r,stats:t.stats||{size:t.length},path:i},n.emit("transferring",p)}function o(){var r=t.read();return r?(a=!1,h=e.write(r,function(){l+=r.length,n.emit("progress",t.path,l,t.length)})):!1}function s(){return u?void(c||(c=!0,r(f))):t.close()}var a=!0,h=!0,u=!1,c=!1,f=null,l=0,p=null;t.on("readable",function(){for(null==p&&i();h&&o(););}),t.on("end",function(){u=!0,a&&e.acceptsEmptyBlocks&&e.write(new Uint8Array(0)),e.end()}),t.on("error",function(t){f=f||t||new Error("Unspecified error"),u=!0,e.end()}),e.on("drain",function(){h=!0;do if(!o())break;while(h)}),e.on("finish",function(){p&&n.emit("transferred",p),s()}),e.on("error",function(t){f=f||t||new Error("Unspecified error"),s()})},t}(),y=function(t){function n(e,n,r,i,o){t.call(this),this.fs=e,this.path=""+n,this.name=new p(n,e).getName(),null!==r&&"undefined"!=typeof r&&(this.relativePath=""+r),i?(this.length=i.size,this.stats=i):(this.length=null,this.stats=null),this.handle=null,this.nextChunkPosition=this.expectedPosition=o||0,this.queue=[],this.started=!1,this.eof=!1,this.closed=!1,this.ended=!1,this.requests=0,this.readable=!1,this.failed=!1}return e(n,t),n.prototype.on=function(e,n){return this._flush(),t.prototype.on.call(this,e,n)},n.prototype._flush=function(){var e=this;try{if(this.closed||this.eof){if(this.requests>0)return;if(null!=this.handle)return this._close();if(this.readable)return;return void(this.ended||(this.ended=!0,this.failed||h.nextTick(function(){return t.prototype.emit.call(e,"end")})))}if(!this.started)return this._open();if(null==this.handle)return;for(;this.requests<4&&!this.closed&&!(this.nextChunkPosition-this.expectedPosition>131072);){var n=32768;this._next(this.nextChunkPosition,n),this.nextChunkPosition+=n}}catch(r){this._error(r)}},n.prototype._next=function(e,n){var r=this;this.requests++;try{this.fs.read(this.handle,new Uint8Array(n),0,n,e,function(i,o,s){if(r.requests--,i)return r._error(i);if(r.closed)return void r._flush();if(0==o)return r.eof=!0,void r._flush();try{var a=s.subarray(0,o);a.position=e;for(var h=r.queue.length;--h>=0&&!(e>r.queue[h].position););r.queue.splice(++h,0,a),o>0&&n>o&&r._next(e+o,n-o),r._flush(),r.readable||0!=h||a.position!=r.expectedPosition||(r.readable=!0,a.length>0&&t.prototype.emit.call(r,"readable"))}catch(i){r._error(i)}})}catch(i){this.requests--,this._error(i)}},n.prototype.read=function(){var t=this.queue[0];return t&&t.position==this.expectedPosition?(this.expectedPosition+=t.length,this.queue.shift(),(0==this.queue.length||this.queue[0].position!=this.expectedPosition)&&(this.readable=!1)):t=null,this._flush(),t},n.prototype._error=function(e){var n=this;this.closed=!0,this.failed=!0,this.queue=[],this._flush(),h.nextTick(function(){return t.prototype.emit.call(n,"error",e)})},n.prototype._open=function(){var t=this;if(!this.started){this.started=!0;try{this.fs.open(this.path,"r",function(e,n){if(e)return t._error(e);if(t.stats)return t.handle=n,void t._flush();try{t.fs.fstat(n,function(e,r){return e?t._error(e):(t.handle=n,t.stats=r,t.length=r.size,void t._flush())})}catch(e){t._error(e)}})}catch(e){this._error(e)}}},n.prototype._close=function(){var t=this;if(this.handle){var e=this.handle;this.handle=null;try{return void this.fs.close(e,function(e){return e?t._error(e):void t._flush()})}catch(n){this._error(n)}}},n.prototype.close=function(){this.closed=!0,this.queue=[],this._flush()},n}(a),v=function(t){function n(e,n){var r=this;t.call(this),this.name=e.name,this.length=e.size,this.blob=e,this.pos=n,this.reader=new FileReader,this.busy=!1,this.readable=!1,this.finished=!1,this.ended=!1,this.queue=[],this.reader.onload=function(e){if(r.busy=!1,!r.finished){var n=new Uint8Array(e.target.result);n.length>0?(r.queue.push(n),r.readable||(r.readable=!0,t.prototype.emit.call(r,"readable"))):r.finished=!0}r.flush()}}return e(n,t),n.prototype.on=function(e,n){return this.flush(),t.prototype.on.call(this,e,n)},n.prototype.flush=function(){var e=this;try{if(this.finished)return void(this.ended||(this.ended=!0,h.nextTick(function(){return t.prototype.emit.call(e,"end")})));if(!this.busy&&this.queue.length<4){var n=this.blob.slice(this.pos,this.pos+32768);this.pos+=n.size,this.busy=!0,this.reader.readAsArrayBuffer(n)}}catch(r){this.finished=!0,this.ended=!0,this.queue=[],h.nextTick(function(){return t.prototype.emit.call(e,"error",r)})}},n.prototype.read=function(){var t=this.queue.shift();return t||(t=null,this.readable=!1),this.flush(),t},n.prototype.close=function(){this.finished=!0,this.flush()},n}(a),m=function(t){function n(e,r){t.call(this),this.fs=e,this.path=""+r,this.name=new p(this.path,e).getName(),this.handle=null,this.position=0,this.queue=[],this.requests=0,this.started=!1,this.ready=!1,this.ended=!1,this.finished=!1,n.prototype.acceptsEmptyBlocks=!0}return e(n,t),n.prototype.on=function(e,n){return t.prototype.on.call(this,e,n)},n.prototype._flush=function(e){var n=this;if(this.ended&&0==this.requests&&0==this.queue.length)return null!=this.handle?this._close():void(this.finished||(this.finished=!0,e?h.nextTick(function(){return t.prototype.emit.call(n,"finish")}):t.prototype.emit.call(this,"finish")));if(this.handle)try{if(this.requests>=4)return void(this.ready=!1);for(;this.requests<4;){var r=this.queue.shift();if(!r)break;this._next(r,this.position),this.position+=r.length}this.ready||this.ended||(this.ready=!0,e||t.prototype.emit.call(this,"drain"))}catch(i){this._error(i)}},n.prototype._next=function(t,e){var n=this,r=t.length;this.requests++;try{this.fs.write(this.handle,t,0,r,e,function(e){return n.requests--,e?n._error(e):("function"==typeof t.callback&&t.callback(),void n._flush(!1))})}catch(i){this.requests--,this._error(i)}},n.prototype._error=function(e){var n=this;this.ready=!1,this.ended=!0,this.finished=!0,this.queue=[],this._flush(!1),h.nextTick(function(){return t.prototype.emit.call(n,"error",e)})},n.prototype.write=function(t,e){return this.ended?!1:(t.length>0&&(t.callback=e,this.queue.push(t)),this.started?(this._flush(!0),this.ready):(this._open(),!1))},n.prototype._open=function(){var t=this;if(!this.started){this.started=!0;try{this.fs.open(this.path,"w",function(e,n){return e?t._error(e):(t.handle=n,void t._flush(!1))})}catch(e){this._error(e)}}},n.prototype._close=function(){var t=this;if(this.handle){var e=this.handle;this.handle=null;try{this.fs.close(e,function(e){return e?t._error(e):void t._flush(!1)})}catch(n){this._error(n)}}},n.prototype.end=function(){this.ready=!1,this.ended=!0,this._flush(!0)},n}(a),w=function(t){function n(){t.call(this)}return e(n,t),n.prototype.on=function(e,n){return t.prototype.on.call(this,e,n)},n.prototype._data=function(e){t.prototype.emit.call(this,"data",e)},n.prototype._end=function(){t.prototype.emit.call(this,"end")},n.prototype.write=function(t,e){return this._data(t),"function"==typeof e&&e(),!0},n.prototype.end=function(){this._end(),t.prototype.emit.call(this,"finish")},n}(a),g=function(t){function n(e){t.call(this),this._decoder=new c(e).getDecoder()}return e(n,t),n.prototype._data=function(t){this._decoder.write(t,0,t.length)},n.prototype._end=function(){},n.prototype.result=function(){return this._decoder.text()},n}(w),_=function(t){function n(e){t.call(this),this._chunks=[],this._mimeType=e}return e(n,t),n.prototype._data=function(t){this._chunks.push(t)},n.prototype._end=function(){var t;this._mimeType&&(t={type:this._mimeType}),this._blob=new Blob(this._chunks,t),this._chunks.length=0},n.prototype.result=function(){return this._blob},n}(w),k=function(t){function n(){t.call(this),this._chunks=[],this._length=0}return e(n,t),n.prototype._data=function(t){this._length+=t.length,this._chunks.push(t)},n.prototype._end=function(){this._buffer=new Uint8Array(this._length);for(var t=0,e=0;e<this._chunks.length;e++){var n=this._chunks[e];this._buffer.set(n,t),t+=n.length}this._chunks.length=0},n.prototype.result=function(){return this._buffer},n}(w),b=function(t){function r(e,n){t.call(this),this._fs=e,this._local=n}return e(r,t),r.prototype.open=function(t,e,r,i){"function"==typeof r&&"undefined"==typeof i&&(i=r,r=null),i=n(this,null,i),this._fs.open(t,e,r,i)},r.prototype.close=function(t,e){e=n(this,null,e),this._fs.close(t,e)},r.prototype.read=function(t,e,r,i,o,s){s=n(this,null,s),this._fs.read(t,e,r,i,o,s)},r.prototype.write=function(t,e,r,i,o,s){s=n(this,null,s),this._fs.write(t,e,r,i,o,s)},r.prototype.lstat=function(t,e){e=n(this,null,e),this._fs.lstat(t,e)},r.prototype.fstat=function(t,e){e=n(this,null,e),this._fs.fstat(t,e)},r.prototype.setstat=function(t,e,r){r=n(this,null,r),this._fs.setstat(t,e,r)},r.prototype.fsetstat=function(t,e,r){r=n(this,null,r),this._fs.fsetstat(t,e,r)},r.prototype.opendir=function(t,e){e=n(this,null,e),this._fs.opendir(t,e)},r.prototype.readdir=function(t,e){if("string"==typeof t){var r=p.check(t,"path"),i={noglobstar:!0,nowildcard:!0,listonly:!0,dotdirs:!0};return void o(this._fs,r,null,i,e)}return e=n(this,null,e),this._fs.readdir(t,e)},r.prototype.unlink=function(t,e){e=n(this,null,e),this._fs.unlink(t,e)},r.prototype.mkdir=function(t,e,r){"function"==typeof e&&"undefined"==typeof r&&(r=e,e=null),r=n(this,null,r),this._fs.mkdir(t,e,r)},r.prototype.rmdir=function(t,e){e=n(this,null,e),this._fs.rmdir(t,e)},r.prototype.realpath=function(t,e){e=n(this,null,e),this._fs.realpath(t,e)},r.prototype.stat=function(t,e){e=n(this,null,e),this._fs.stat(t,e)},r.prototype.rename=function(t,e,r){r=n(this,null,r),this._fs.rename(t,e,r)},r.prototype.readlink=function(t,e){e=n(this,null,e),this._fs.readlink(t,e)},r.prototype.symlink=function(t,e,r){r=n(this,null,r),this._fs.symlink(t,e,r)},r.prototype.join=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=new p("",this._fs);return n.join.apply(n,arguments).normalize().path},r.prototype.link=function(t,e,r){r=n(this,null,r),this._fs.link(t,e,r)},r.prototype.list=function(t,e){var t=p.check(t,"remotePath"),r={directories:!0,files:!0,nosort:!1,dotdirs:!1,noglobstar:!0,listonly:!0},i=new u;return e=n(this,i,e),o(this._fs,t,i,r,e),i},r.prototype.search=function(t,e,r){var t=p.check(t,"remotePath");"function"==typeof e&&"undefined"==typeof r&&(r=e,e=null);var i=new u;return r=n(this,i,r),o(this._fs,t,i,e,r),i},r.prototype.info=function(t,e){var t=p.check(t,"remotePath"),r={itemonly:!0},i=new u;return e=n(this,i,e),o(this._fs,t,i,r,function(t,n){return t?e(t,null):n&&1==n.length?void e(null,n[0]):e(new Error("Unexpected result"),null)}),i},r.prototype.readFile=function(t,e,r){var i=p.create(t,this._fs,"remotePath");"function"==typeof e&&"undefined"==typeof r&&(r=e,e=null);var o=new u;r=n(this,o,r),e=e||{};var s=e.type,a=e.encoding;s?(s=(s+"").toLowerCase(),("string"==s||"text"==s)&&(a=a||"utf8")):s=a?"string":"buffer";var h;switch(s){case"text":case"string":h=new g(a);break;case"array":case"buffer":h=new k;break;case"blob":h=new _(e.mimeType);break;default:throw new Error("Unsupported data kind: "+e.type)}var c=new y(i.fs,i.path);return d.copy(c,h,o,function(t){return t?r(t,null):void r(null,h.result())}),o},r.prototype.putFile=function(t,e,n){var r=p.create(t,this._local,"localPath"),i=p.create(e,this._fs,"remotePath");return this._copyFile(r,i,n)},r.prototype.getFile=function(t,e,n){var r=p.create(t,this._fs,"remotePath"),i=p.create(e,this._local,"localPath");return this._copyFile(r,i,n)},r.prototype._copyFile=function(t,e,r){var i=new u;if(r=n(this,i,r),e.endsWithSlash()){var o=t.getName();e=e.join(o)}var s=new y(t.fs,t.path),a=new m(e.fs,e.path);return d.copy(s,a,i,function(t){return r(t)}),i},r.prototype.upload=function(t,e,n){var r=p.create(e,this._fs,"remotePath");return this._copy(t,this._local,r,n)},r.prototype.download=function(t,e,n){var r=p.create(e,this._local,"localPath");return this._copy(t,this._fs,r,n)},r.prototype._copy=function(t,e,r,i){function o(n,r){if(n)return i(n);if(!d.isDirectory(r))return i(new Error("Target path is not a directory"));try{s(e,t,c,function(t,e){if(t)return i(t);try{f=e,f.forEach(function(){}),a()}catch(t){i(t)}})}catch(n){i(n)}}function a(){function t(t){if(t)return i(t);if(d.isDirectory(o.stats))d.mkdir(l,s,n);else{var e=new m(l,s);d.copy(o,e,c,n)}}function n(t){return t?i(t):void a()}var o=f.shift();if(!o)return i(null);var s;if("string"==typeof o.relativePath){var u=new p(o.relativePath,e);s=r.join(u).normalize().path,h(u,t)}else s=r.join(o.name).path,t(null)}function h(t,e){var n=t.getParent();if(n.isTop())return e(null);var i=y[n];return i?e(null):void h(n,function(t){if(t)return e(t);try{var i=r.join(n).path;d.mkdir(l,i,function(t){return t?e(t):(y[n]=!0,void e(null))})}catch(t){e(t)}})}var c=new u;i=n(this,c,i);var f=null,l=r.fs;r=r.removeTrailingSlash(),l.stat(r.path,o);var y={};return c},r}(a),E=function(){function t(t){var e=this;this.ws=t,this.failed=!1,this.wasConnected=t.readyState==WebSocket.OPEN,this.ws.onclose=function(t){var n=t.code,r=t.reason;e.close(n,r)},this.ws.onerror=function(){e.failed=!0},this.ws.onmessage=function(t){var n;n=new Uint8Array(t.data),"function"==typeof e.onmessage&&e.onmessage(n)}}return t.prototype.open=function(t){var e=this;"function"!=typeof t&&(t=function(){});var n=0,r=null;switch(this.ws.readyState){case WebSocket.CLOSED:case WebSocket.CLOSING:n=999,r="WebSocket has been closed";break;case WebSocket.OPEN:return this.wasConnected=!0,void h.nextTick(function(){return t()});case WebSocket.CONNECTING:break;default:n=999,r="WebSocket state is unknown"}return null!=r?void h.nextTick(function(){e.close(n,r)}):(this.onopen=t,void(this.ws.onopen=function(){e.wasConnected=!0;var t=e.onopen;e.onopen=null,"function"==typeof t&&t()}))},t.prototype.on=function(t,e){switch(t){case"ready":this.open(e);break;case"message":this.onmessage=e;break;case"close":this.onclose=e;break;case"error":this.onerror=e}return this},t.prototype.reportError=function(t){if("function"!=typeof this.onerror)throw t;this.onerror(t)},t.prototype.close=function(t,e,n){if("number"!=typeof t&&(t=1e3),e=""+e,n=n||"EFAILURE",null!=this.ws)try{this.ws.close()}catch(r){this.reportError(r)}finally{this.ws=null}var i=this.onclose;if(this.onopen=null,this.onclose=null,"function"==typeof i){var o,r=null;switch(t){case 999:o=e;break;case 1e3:o="Connection closed",n="ECONNRESET";break;case 1006:o="Connection aborted",n="ECONNABORTED";break;default:o="Connection failed",n="ECONNRESET"}(!this.wasConnected||this.failed||1e3!=t)&&(this.wasConnected?this.failed&&(o="Connection failed",n="ECONNRESET"):(o="Unable to connect",n="ECONNREFUSED"),r=new Error(o),t>=1e3&&(r.reason=t),r.code=n),i(r)}},t.prototype.send=function(t){var e=this;if(null!=this.ws)try{this.ws.send(t)}catch(n){h.nextTick(function(){e.reportError(n)})}},t}(),x=function(){function t(){}return t.prototype.check=function(t){var e=this.length-this.position;if(t>e)throw new Error("Unexpected end of packet")},t.prototype.skip=function(t){this.check(t),this.position+=t},t.isBuffer=function(t){return t&&t.buffer instanceof ArrayBuffer&&"undefined"!=typeof t.byteLength},t}(),S=function(t){function n(e){t.call(this),this.buffer=e,this.position=0,this.length=e.length;var n=this.readInt32()+4;if(n!=this.length)throw new Error("Invalid packet received");this.type=this.readByte(),1==this.type||2==this.type?this.id=null:(this.id=this.readInt32(),200==this.type&&(this.type=this.readString()))}return e(n,t),n.prototype.readByte=function(){this.check(1);var t=255&this.buffer[this.position++];return t},n.prototype.readInt32=function(){var t=this.readUint32();return 2147483648&t&&(t-=4294967296),t},n.prototype.readUint32=function(){this.check(4);var t=0;return t|=(255&this.buffer[this.position++])<<24,t|=(255&this.buffer[this.position++])<<16,t|=(255&this.buffer[this.position++])<<8,t|=255&this.buffer[this.position++]},n.prototype.readInt64=function(){var t=this.readInt32(),e=this.readUint32(),n=4294967296*t+e;return n},n.prototype.readString=function(){var t=this.readInt32();this.check(t);var e=this.position+t,n=i(this.buffer,this.position,e);return this.position=e,n},n.prototype.skipString=function(){var t=this.readInt32();this.check(t);var e=this.position+t;this.position=e},n.prototype.readData=function(t){var e=this.readInt32();this.check(e);var n=this.position,r=n+e;this.position=r;var i=this.buffer.subarray(n,r);if(t){var o=new Uint8Array(e);return o.set(i,0),o}return i},n}(x),P=function(t){function n(e){t.call(this),this.buffer=new Uint8Array(e),this.position=0,this.length=e}return e(n,t),n.prototype.start=function(){this.position=0,this.writeInt32(0),this.writeByte("number"==typeof this.type?this.type:200),1==this.type||2==this.type||(this.writeInt32(0|this.id),"number"!=typeof this.type&&this.writeString(this.type))},n.prototype.finish=function(){var t=this.position;return this.position=0,this.writeInt32(t-4),this.buffer.subarray(0,t)},n.prototype.writeByte=function(t){this.check(1),this.buffer[this.position++]=255&t},n.prototype.writeInt32=function(t){this.check(4),this.buffer[this.position++]=t>>24&255,this.buffer[this.position++]=t>>16&255,this.buffer[this.position++]=t>>8&255,this.buffer[this.position++]=255&t},n.prototype.writeInt64=function(t){var e=t/4294967296|0,n=4294967295&t|0;this.writeInt32(e),this.writeInt32(n)},n.prototype.writeString=function(t){"string"!=typeof t&&(t=""+t);var e=this.position;this.writeInt32(0);var n=r(t,this.buffer,this.position);if(0>n)throw new Error("Not enough space in the buffer");this.position=e,this.writeInt32(n),this.position+=n},n.prototype.writeData=function(t,e,n){"undefined"!=typeof e&&(t=t.subarray(e,n));var r=t.length;this.writeInt32(r),this.check(r),this.buffer.set(t,this.position),this.position+=r},n}(x),I=function(){function t(){}return t.toNumber=function(t){if("number"==typeof t)return 63&t;switch(t){case"r":return 1;case"r+":return 3;case"w":return 26;case"w+":return 27;case"wx":case"xw":return 42;case"wx+":case"xw+":return 43;case"a":return 14;case"a+":return 15;case"ax":case"xa":return 46;case"ax+":case"xa+":return 47;default:throw Error("Invalid flags '"+t+"'")}},t.fromNumber=function(t){switch(t&=63,0!=(32&t)&&(t&=47),0!=(16&t)&&(t&=59),0==(3&t)&&(t|=1),0==(8&t)?t&=3:t|=2,t){case 1:return["r"];case 2:case 3:return["r+"];case 10:return["wx","r+"];case 11:return["wx+","r+"];case 14:return["a"];case 15:return["a+"];case 26:return["w"];case 27:return["w+"];case 42:return["wx"];case 43:return["wx+"];case 46:return["ax"];case 47:return["ax+"]}throw Error("Unsupported flags")},t}(),q=function(){function t(){}return t.isKnown=function(e){return t.hasOwnProperty("_"+e)},t.POSIX_RENAME="posix-rename@openssh.com",t.STATVFS="statvfs@openssh.com",t.FSTATVFS="fstatvfs@openssh.com",t.HARDLINK="hardlink@openssh.com",t.FSYNC="fsync@openssh.com",t.NEWLINE="newline@sftp.ws",t.CHARSET="charset@sftp.ws",t._constructor=function(){for(var e in t)t.hasOwnProperty(e)&&(t["_"+t[e]]=!0)}(),t}(),T=(function(){function t(){}return t.write=function(t,e,n){t.type=101,t.start(),t.writeInt32(e),t.writeString(n),t.writeInt32(0)},t.writeSuccess=function(t){this.write(t,0,"OK")},t}(),function(){function t(){}return t}(),function(){function t(t){if("undefined"==typeof t)return void(this.flags=0);var e=this.flags=t.readUint32();if(1&e&&(this.size=t.readInt64()),2&e&&(this.uid=t.readInt32(),this.gid=t.readInt32()),4&e&&(this.mode=t.readUint32()),8&e&&(this.atime=new Date(1e3*t.readUint32()),this.mtime=new Date(1e3*t.readUint32())),2147483648&e){this.flags&=2147483647,this.size=t.readInt64();for(var n=0;n<this.size;n++)t.skipString(),t.skipString()}}return t.prototype.isDirectory=function(){return 16384==(61440&this.mode)},t.prototype.isFile=function(){return 32768==(61440&this.mode)},t.prototype.isSymbolicLink=function(){return 40960==(61440&this.mode)},t.prototype.write=function(t){var e=this.flags;t.writeInt32(e),1&e&&t.writeInt64(this.size),2&e&&(t.writeInt32(this.uid),t.writeInt32(this.gid)),4&e&&t.writeInt32(this.mode),8&e&&(t.writeInt32(this.atime.getTime()/1e3),t.writeInt32(this.mtime.getTime()/1e3)),2147483648&e&&t.writeInt32(0)},t.prototype.from=function(t){if(null==t||"undefined"==typeof t)this.flags=0;
else{var e=0;"undefined"!=typeof t.size&&(e|=1,this.size=0|t.size),("undefined"!=typeof t.uid||"undefined"!=typeof t.gid)&&(e|=2,this.uid=0|t.uid,this.gid=0|t.gid),"undefined"!=typeof t.mode&&(e|=4,this.mode=0|t.mode),("undefined"!=typeof t.atime||"undefined"!=typeof t.mtime)&&(e|=8,this.atime=t.atime,this.mtime=t.mtime),"undefined"!=typeof t.nlink&&(this.nlink=t.nlink),this.flags=e}},t}()),SftpItem=function(){function SftpItem(){}return SftpItem}(),C=function(){function t(t,e){this._handle=t,this._this=e}return t.prototype.toString=function(){for(var t="0x",e=0;e<this._handle.length;e++){var n=this._handle[e],r=n.toString(16);16>n&&(t+="0"),t+=r}return t},t}(),N=function(){function t(){this._host=null,this._id=null,this._ready=!1,this._requests=[],this._extensions={},this._maxWriteBlockLength=32768,this._maxReadBlockLength=262144}return t.prototype.getRequest=function(t){var e=new P(this._maxWriteBlockLength+1024);if(e.type=t,e.id=this._id,1==t){if(null!=this._id)throw new Error("Already initialized");this._id=1}else this._id=this._id+1&4294967295;return e.start(),e},t.prototype.writeStats=function(t,e){var n=new T;n.from(e),n.write(t)},t.prototype.execute=function(t,e,n,r){var i=this;if("function"!=typeof e&&(e=function(t){if(t)throw t}),!this._host)return void h.nextTick(function(){var t=i.createError(6,"Not connected",r);e(t)});if("undefined"!=typeof this._requests[t.id])throw new Error("Duplicate request");var o=t.finish();this._host.send(o),this._requests[t.id]={callback:e,responseParser:n,info:r}},t.prototype._init=function(t,e){var n=this;if(this._host)throw new Error("Already bound");this._host=t,this._extensions={};var r=this.getRequest(1);r.writeInt32(3);var i={command:"init"};this.execute(r,e,function(r){if(2!=r.type){t.close(3002);var o=n.createError(5,"Unexpected message",i);return e(new Error("Protocol violation"))}var s=r.readInt32();if(3!=s){t.close(3002);var o=n.createError(5,"Unexpected protocol version",i);return e(o)}for(;r.length-r.position>=4;){var a,h=r.readString();a=q.isKnown(h)?r.readString():r.readData(!0);var u=n._extensions[h]||[];u.push(a),n._extensions[h]=u}n._ready=!0,e(null)},i)},t.prototype._process=function(t){var e=new S(t),n=this._requests[e.id];if("undefined"==typeof n)throw new Error("Unknown response ID");delete this._requests[e.id],e.info=n.info,n.responseParser.call(this,e,n.callback)},t.prototype._end=function(){var t=this._host;t&&(this._host=null),this.failRequests(7,"Connection lost")},t.prototype.end=function(){var t=this._host;t&&(this._host=null,t.close()),this.failRequests(7,"Connection closed")},t.prototype.failRequests=function(t,e){var n=this,r=this._requests;this._requests=[],r.forEach(function(r){var i=n.createError(t,e,r.info);r.callback(i)})},t.prototype.open=function(t,e,n,r){t=this.checkPath(t,"path"),"function"==typeof n&&"undefined"==typeof r&&(r=n,n=null);var i=this.getRequest(3);i.writeString(t),i.writeInt32(I.toNumber(e)),this.writeStats(i,n),this.execute(i,r,this.parseHandle,{command:"open",path:t})},t.prototype.close=function(t,e){var n=this.toHandle(t),r=this.getRequest(4);r.writeData(n),this.execute(r,e,this.parseStatus,{command:"close",handle:t})},t.prototype.read=function(t,e,n,r,i,o){var s=this,a=this.toHandle(t);this.checkBuffer(e,n,r),this.checkPosition(i),r>this._maxReadBlockLength&&(r=this._maxReadBlockLength);var h=this.getRequest(5);h.writeData(a),h.writeInt64(i),h.writeInt32(r),this.execute(h,o,function(t){return s.parseData(t,o,0,a,e,n,r,i)},{command:"read",handle:t})},t.prototype.write=function(t,e,n,r,i,o){var s=this.toHandle(t);if(this.checkBuffer(e,n,r),this.checkPosition(i),r>this._maxWriteBlockLength)throw new Error("Length exceeds maximum allowed data block length");var a=this.getRequest(6);a.writeData(s),a.writeInt64(i),a.writeData(e,n,n+r),this.execute(a,o,this.parseStatus,{command:"write",handle:t})},t.prototype.lstat=function(t,e){t=this.checkPath(t,"path"),this.command(7,[t],e,this.parseAttribs,{command:"lstat",path:t})},t.prototype.fstat=function(t,e){var n=this.toHandle(t),r=this.getRequest(8);r.writeData(n),this.execute(r,e,this.parseAttribs,{command:"fstat",handle:t})},t.prototype.setstat=function(t,e,n){t=this.checkPath(t,"path");var r=this.getRequest(9);r.writeString(t),this.writeStats(r,e),this.execute(r,n,this.parseStatus,{command:"setstat",path:t})},t.prototype.fsetstat=function(t,e,n){var r=this.toHandle(t),i=this.getRequest(10);i.writeData(r),this.writeStats(i,e),this.execute(i,n,this.parseStatus,{command:"fsetstat",handle:t})},t.prototype.opendir=function(t,e){t=this.checkPath(t,"path"),this.command(11,[t],e,this.parseHandle,{command:"opendir",path:t})},t.prototype.readdir=function(t,e){var n=this.toHandle(t),r=this.getRequest(12);r.writeData(n),this.execute(r,e,this.parseItems,{command:"readdir",handle:t})},t.prototype.unlink=function(t,e){t=this.checkPath(t,"path"),this.command(13,[t],e,this.parseStatus,{command:"unline",path:t})},t.prototype.mkdir=function(t,e,n){t=this.checkPath(t,"path"),"function"==typeof e&&"undefined"==typeof n&&(n=e,e=null);var r=this.getRequest(14);r.writeString(t),this.writeStats(r,e),this.execute(r,n,this.parseStatus,{command:"mkdir",path:t})},t.prototype.rmdir=function(t,e){t=this.checkPath(t,"path"),this.command(15,[t],e,this.parseStatus,{command:"rmdir",path:t})},t.prototype.realpath=function(t,e){t=this.checkPath(t,"path"),this.command(16,[t],e,this.parsePath,{command:"realpath",path:t})},t.prototype.stat=function(t,e){t=this.checkPath(t,"path"),this.command(17,[t],e,this.parseAttribs,{command:"stat",path:t})},t.prototype.rename=function(t,e,n){t=this.checkPath(t,"oldPath"),e=this.checkPath(e,"newPath"),this.command(18,[t,e],n,this.parseStatus,{command:"rename",oldPath:t,newPath:e})},t.prototype.readlink=function(t,e){t=this.checkPath(t,"path"),this.command(19,[t],e,this.parsePath,{command:"readlink",path:t})},t.prototype.symlink=function(t,e,n){t=this.checkPath(t,"targetPath"),e=this.checkPath(e,"linkPath"),this.command(20,[t,e],n,this.parseStatus,{command:"symlink",targetPath:t,linkPath:e})},t.prototype.link=function(t,e,n){t=this.checkPath(t,"oldPath"),e=this.checkPath(e,"newPath"),this.command(q.HARDLINK,[t,e],n,this.parseStatus,{command:"link",oldPath:t,newPath:e})},t.prototype.toHandle=function(t){if(!t)throw new Error("Missing handle");if("object"==typeof t&&x.isBuffer(t._handle)&&t._this==this)return t._handle;throw new Error("Invalid handle")},t.prototype.checkBuffer=function(t,e,n){if(!x.isBuffer(t))throw new Error("Invalid buffer");if("number"!=typeof e||0>e)throw new Error("Invalid offset");if("number"!=typeof n||0>n)throw new Error("Invalid length");if(e+n>t.length)throw new Error("Offset or length is out of bands")},t.prototype.checkPath=function(t,e){return t=p.check(t,e),"~"===t[0]&&("/"===t[1]?t="."+t.substr(1):1==t.length&&(t=".")),t},t.prototype.checkPosition=function(t){if("number"!=typeof t||0>t||t>0x8000000000000000)throw new Error("Invalid position")},t.prototype.command=function(t,e,n,r,i){for(var o=this.getRequest(t),s=0;s<e.length;s++)o.writeString(e[s]);this.execute(o,n,r,i)},t.prototype.readStatus=function(t){var e=t.readInt32(),n=t.readString();if(0==e)return null;var r=t.info;return this.createError(e,n,r)},t.prototype.readItem=function(t){var e=new SftpItem;return e.filename=t.readString(),e.longname=t.readString(),e.stats=new T(t),e},t.prototype.createError=function(t,e,n){var r,i;switch(t){case 1:r="EOF",i=1;break;case 2:r="ENOENT",i=34;break;case 3:r="EACCES",i=3;break;case 0:case 4:case 5:r="EFAILURE",i=-2;break;case 6:r="ENOTCONN",i=31;break;case 7:r="ESHUTDOWN",i=46;break;case 8:r="ENOSYS",i=35;break;case 5:r="ESHUTDOWN",i=46;break;default:r="UNKNOWN",i=-1}var o=n.command,s=n.path||n.handle;s="string"==typeof s?"'"+s+"'":s?new String(s):"";var a=new Error(r+", "+o+" "+s);a.errno=i,a.code=r;for(var h in n)"command"!=h&&n.hasOwnProperty(h)&&(a[h]=n[h]);return a.nativeCode=t,a.description=e,a},t.prototype.checkResponse=function(t,e,n){if(101==t.type){var r=this.readStatus(t);if(null!=r)return n(r),!1}if(t.type!=e)throw new Error("Unexpected packet received");return!0},t.prototype.parseStatus=function(t,e){this.checkResponse(t,101,e)&&e(null)},t.prototype.parseAttribs=function(t,e){if(this.checkResponse(t,105,e)){var n=new T(t);delete n.flags,e(null,n)}},t.prototype.parseHandle=function(t,e){if(this.checkResponse(t,102,e)){var n=t.readData(!0);e(null,new C(n,this))}},t.prototype.parsePath=function(t,e){if(this.checkResponse(t,104,e)){var n=t.readInt32();if(1!=n)throw new Error("Invalid response");var r=t.readString();e(null,r)}},t.prototype.parseData=function(t,e,n,r,i,o,s,a){var h=this;if(101==t.type){var u=this.readStatus(t);if(null!=u)return void(1==u.nativeCode?e(null,0,i):e(u,0,null))}var c=t.readData(!1);if(c.length>s)throw new Error("Received too much data");if(s=c.length,0==s){if(n>4){var u=this.createError(4,"Unable to read data",t.info);return u.code="EIO",u.errno=55,void e(u,0,null)}var f=this.getRequest(5);return f.writeData(r),f.writeInt64(a),f.writeInt32(s),void this.execute(f,e,function(t){return h.parseData(t,e,n+1,r,i,o,s,a)},t.info)}i.set(c,o),e(null,s,i)},t.prototype.parseItems=function(t,e){if(101==t.type){var n=this.readStatus(t);if(null!=n)return void(1==n.nativeCode?e(null,!1):e(n,null))}if(104!=t.type)throw new Error("Unexpected packet received");for(var r=t.readInt32(),i=[],o=0;r>o;o++)i[o]=this.readItem(t);e(null,i)},t}(),A=function(t){function n(e){var n=new N;t.call(this,n,e)}return e(n,t),n.prototype.bind=function(t,e){function n(t){if("function"==typeof e)try{e(t),t=null}catch(n){t=n}t&&s.emit("error",t)}var r=this,i=this._fs;if(this._bound)throw new Error("Already bound");this._bound=!0;var o=!1,s=this;t.on("ready",function(){o=!0,i._init(t,function(t){return t?(i._end(),r._bound=!1,n(t)):(n(null),void r.emit("ready"))})}),t.on("message",function(t){try{i._process(t)}catch(e){r.emit("error",e),i.end()}}),t.on("error",function(t){r.emit("error",t),i.end()}),t.on("close",function(t){o?(i._end(),r._bound=!1,r.emit("close",t)):(t=t||new Error("Unable to connect"),n(t))})},n.prototype.end=function(){var t=this._fs;t.end()},n}(b),U=function(t){function n(){t.call(this,null)}return e(n,t),n.prototype.on=function(e,n){return t.prototype.on.call(this,e,n)},n.prototype.once=function(e,n){return t.prototype.on.call(this,e,n)},n.prototype.connect=function(e,n,r){n=n||{},"undefined"==typeof n.protocol&&(n.protocol="sftp");var i=[];i.push("object"!=typeof n||"undefined"==typeof n.protocol?"sftp":n.protocol);var o=new WebSocket(e,i);o.binaryType="arraybuffer";var s=new E(o);t.prototype.bind.call(this,s,r)},n}(A);t.Client=U}(SFTP||(SFTP={}));